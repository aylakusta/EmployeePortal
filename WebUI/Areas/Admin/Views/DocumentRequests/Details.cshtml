@model WebUI.Models.DocumentRequest
@using WebUI.Models
@{
    ViewData["Title"] = "Talep Detayı";
    string typeLabel = Model.Type == DocumentRequestType.MedicalReport ? "Rapor" : "Yıllık İzin";
}
<div class="card shadow-sm">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h3 class="mb-0">@ViewData["Title"]</h3>
    <a asp-area="Admin" asp-controller="DocumentRequests" asp-action="Index" class="btn btn-secondary btn-sm">Geri</a>
  </div>
  <div class="card-body">
    <dl class="row">
      <dt class="col-sm-3">Tür</dt>
      <dd class="col-sm-9">@typeLabel</dd>

      <dt class="col-sm-3">Oluşturma</dt>
      <dd class="col-sm-9">@Model.CreatedAt.ToLocalTime()</dd>

      <dt class="col-sm-3">Tarih Aralığı</dt>
      <dd class="col-sm-9">
        @if (Model.StartDate.HasValue || Model.EndDate.HasValue)
        { <text>@(Model.StartDate?.ToString("dd.MM.yyyy") ?? "—") - @(Model.EndDate?.ToString("dd.MM.yyyy") ?? "—")</text> }
        else { <span class="text-muted">—</span> }
      </dd>

      <dt class="col-sm-3">Dosya</dt>
      <dd class="col-sm-9">
        @if (!string.IsNullOrWhiteSpace(Model.UploadedFilePath))
        {
          <a asp-area="Admin" asp-controller="DocumentRequests" asp-action="Download" asp-route-id="@Model.Id" class="btn btn-sm btn-outline-secondary">İndir</a>
          <div class="text-muted mt-1">@Model.UploadedFileName</div>
        }
        else { <span class="text-muted">—</span> }
      </dd>

      <dt class="col-sm-3">Attendance</dt>
      <dd class="col-sm-9">
        @if (Model.AttendanceRef != null)
        {
          var label = Model.AttendanceRef.Reason switch {
            AttendanceReason.Report => "Rapor",
            AttendanceReason.Bereavement => "Yakın Vefatı",
            AttendanceReason.Birth => "Doğum",
            _ => "Mazeret"
          };
          <div>@label - @Model.AttendanceRef.Description</div>
          <div class="text-muted">Oluşturma: @Model.AttendanceRef.CreatedAt.ToLocalTime()</div>
          <div>Durum: @(Model.AttendanceRef.IsResolved ? "Tamamlandı" : "Bekliyor")</div>
        }
        else { <span class="text-muted">—</span> }
      </dd>

      <dt class="col-sm-3">Talep Durumu</dt>
      <dd class="col-sm-9">@((Model.CompletedAt!=null) ? $"Tamamlandı ({Model.CompletedAt.Value.ToLocalTime()})" : "Eksik")</dd>
    </dl>

    <div class="d-flex gap-2">
      @if (Model.CompletedAt == null)
      {
        <form asp-area="Admin" asp-controller="DocumentRequests" asp-action="MarkCompleted" asp-route-id="@Model.Id" method="post">
          @Html.AntiForgeryToken()
          <button class="btn btn-success">Tamamlandı</button>
        </form>
      }
      <a asp-area="Admin" asp-controller="AttendanceReviews" asp-action="Details" asp-route-id="@Model.AttendanceId"
         class="btn btn-outline-primary">Attendance’a Git</a>
    </div>
  </div>
</div>
